\input texinfo @c -*-texinfo-*-
@comment %**start of header
@setfilename textmidi.info
@settitle textmidi
@documentencoding US-ASCII
@comment %**end-of-header
@dircategory music
@direntry
* textmidi: (textmidi.info). Convert text to MIDI files.
@end direntry

@comment @documentlanguage en_US

@titlepage
@title Using @command{textmidi}
@subtitle The textmidi language to MIDI translator
@author Thomas E. Janzen
@end titlepage
@copying
Copyright @copyright{} 2023 Thomas E. Janzen.
@quotation
Permission is granted to copy, distribute and/or modify this document
under the terms of the GNU Free Documentation License, Version 1.2
or any later version published by the Free Software Foundation; with no
Invariant Sections, no Front-Cover Texts, and no Back-Cover Texts.
A copy of the
license is included in the section entitled ``GNU Free Documentation License.''
@end quotation
@end copying
@insertcopying

@ifnottex
@node Top
@top textmidi

@end ifnottex
@contents

@menu
* Overview::
* Invoking textmidi::
* @command{textmidi} Language::
* Using m4 with textmidi::
* File Formats::
* Gvim Highlighting::
* Installation::
* GNU Free Documentation License::
* Bibliography::
* Concept Index::
@end menu

@node Overview
@chapter Overview
@cindex overview
The @command{textmidi} program translates a text representation of a
standard MIDI (Musical Instrument Digital Interface) file into a binary
standard MIDI file.  Using @command{textmidi}, it is possible to write very precise
MIDI files, with delays down to the MIDI tick, in a way that GUI-based
tools may not offer.  Previously-created MIDI files may be converted into
@command{textmidi} language using the @command{miditext} tool, and then
edited for re-translation by @command{textmidi}.  The goal of @command{textmidi}
and @command{miditext} together is to permit the specification of
any musical events that are permitted by the MIDI 1.1 spec's chapter
on Standard MIDI Files.  SysEx (system exclusive) is also supported,
as are all three filetypes (single track, multitrack and multi-sequence).

No attempt is made in @command{textmidi} to support either MIDI show control
or machine control.

MIDI Running-status is used, but resets if a non-channel voice command
interrupts the stream.  @command{miditext} permits input files to
use running-status more freely.
@menu
* What is textmidi?::
* MIDI Summary::
* History::
@end menu

@node What is textmidi?
@section What is textmidi?
@cindex textmidi
The program @command{textmidi} reads a text representation of a standard MIDI 
file in what is called here @quotedblleft{}textmidi@quotedblright{} language,
and converts it to a standard MIDI file, which is binary.  Each item in the text
file corresponds to a sequence of command bytes in the binary MIDI file, more or
less.

Developing MIDI files as text in textmidi language can offer advantages in that
text files can readily be hand-edited, automatically-generated, searched with search
tools, and enriched with macro processors, such as m4.

@command{textmidi} is a language translator for the @command{textmidi}
language.  It does not create or use graphical musical scores.
@command{textmidi} does not record or play over a MIDI interface.


@node MIDI Summary
@section MIDI Summary
@cindex MIDI Summary
Standard MIDI files are generally used to represent conventionally scored music,
usually instrumental music.  MIDI is a means of connecting electronic
instruments, sequencers, and computers: A current-loop connection is
defined but USB is often used today.  MIDI is also a sort of industrial
control protocol which assigns (at least) numbers to the keys of a piano
keyboard, numbers to the velocity with which the key was hit
(giving loudness), and delays
between the points of hitting and releasing keys.  For example, Middle C,
(often about 261 cycles/second), is assigned 60 decimal; the velocities
range from 0 to 127.  Delays between events can be up to 28 bits in
units of MIDI ticks.  Since quarter notes are often assigned a duration
of 240 ticks, either a note or a rest could be as long as 1118481 quarter
notes or 279620 whole notes.  Since delays are variable-length quantities
(in byte steps), they can range from 1 byte to 4 bytes in size in the
MIDI file, but as only 7 bits of value are permitted in each byte,
values can be only up to 28 bits long (unsigned).  
MIDI also specifies controls, such as damper pedals and
"pressure" (named for pressure-sensitive keyboards that permit making
a note louder or software by changing the force applied to the key), and
synthesizer-specific message handling as "SYSEX" or "System Exclusive"
messages.  As a result of encoding key presses rather than audio signals,
MIDI files can be nearly 300 times smaller than a stereo MP3 file of
the same piece.  A disadvantage is that support for MIDI features and
the General MIDI instrument definitions is sometimes poor.

@cindex midi files
Standard MIDI files are a means of describing a musical performance
in time.  MIDI files can be created by software that records the MIDI
stream received over a MIDI interface as you play a piano or other MIDI
controller.  MIDI files can also be created on sequencing or scoring
software.

@node History
@section History
@cindex history
@command{textmidi} was developed in 1999 and improved in 2020
to 2022 in order to add support for more of the MIDI specification.
It was used in 2003 to create the MIDI file for the Quintet for piano
and strings by Robert Schumann, which was added to the Classical MIDI
Archive at that time.

@node Invoking textmidi
@chapter Invoking textmidi
@cindex Invoking textmidi
@menu
* Options::
* Invocation Examples::
@end menu

@node Options
@section Options
@cindex Options
@smallexample
textmidi [@b{@minus{}i}|@b{@minus{}@minus{}textmidi}] @var{textmidi_input_file} @b{@minus{}o}|@b{@minus{}@minus{}midi} @var{standard_midi_output_file}
[@b{@minus{}a}|@b{@minus{}@minus{}answer}] [@b{@minus{}d}|@b{@minus{}@minus{}detache} @var{numticks}]
[@b{@minus{}l}|@b{@minus{}@minus{}lazynoteoff}] [@b{@minus{}h}|@b{@minus{}@minus{}help}]
[@b{@minus{}V}|@b{@minus{}@minus{}version}] [@b{@minus{}v}|@b{@minus{}@minus{}verbose}]
@end smallexample

@table @option
@cindex @command{textmidi} command line options.
@item -h, --help
@cindex @minus{}h, @minus{}@minus{}help
Print the options summary.
@item -v, --verbose
@cindex  @minus{}v, @minus{}@minus{}verbose
Write some informative messages to the screen.  Errors are printed
regardless.
@item -V, --version
@cindex  @minus{}V, @minus{}@minus{}version
Print the version of @command{textmidi}.
@item -i, --textmidi textmidi_input_file
@cindex @minus{}i, @minus{}@minus{}textmidi
The input file: a text representation of a MIDI file in @command{textmidi} language.
@item -o, --midi standard_midi_output_file
@cindex @minus{}o, @minus{}@minus{}midi
The output file; a binary standard MIDI file.
@item -d, --detache num
@cindex @minus{}d, @minus{}@minus{}detache
A small number of MIDI ticks to separate consecutive notes.  It always
is shaved off the end of preceding note events and made into a rest
(but not taken from preceding rests).  The default is 0.
Originally, the default was 10 and was based on experience with MIDI synthesizers
from the 1980's that could behave poorly with high rates of note events
with no delay between note-off and note-on events.
The time is stolen from the preceding note's duration, not added.
@item -l, --lazynoteoff
@cindex @minus{}l, @minus{}@minus{}lazynoteoff
In LAZY mode, for the ends of a note's duration, use a MIDI note-off
with the global velocity rather than a note-on with a velocity of zero.
@item -a, --answer
@cindex @minus{}a, @minus{}@minus{}answer
If the output textmidi file already exists, ask before overwriting it.
@end table

@node Invocation Examples
@section Invocation Examples
@cindex  Invocation Examples
The following command will read the hand-edited prelude.txt and convert
it to the standard MIDI file prelude.mid, with no separation between the
end of notes and the notes that follow them.  If LAZY mode is used in the
textmidi file, end notes using a note-on event with a velocity of zero.

@smallexample
@command{textmidi} --textmidi prelude.txt --midi prelude.mid --detache 0
@end smallexample

The following converts prelude.txt into prelude.mid, using the default 20
ticks between notes and a MIDI note-off event with the current velocity
to end each note in LAZY mode rather than a note-on.

@smallexample
@command{textmidi} --textmidi prelude.txt --midi prelude.mid --lazynoteoff
@end smallexample

@node @command{textmidi} Language
@chapter @command{textmidi} Language
@cindex textmidi language
The language used in @command{textmidi} text files represents binary
events and commands of MIDI standard file; multiple bytes
typically represent a MIDI event or command.
There are two modes: Detail mode and LAZY mode.  LAZY mode can contain only
notes, rests, durations, dynamics, and the chan (channel) command.
The @command{textmidi} language is case-insensitive except for the "b" used for a flat
sign.  The b for a flat sign as in Ab3 must be lower case.  ab3 is the same
as Ab3, but there is no note name aB3.
A semicolon is the comment character and marks the remainder of a line as
@cindex comment
comment not to be converted into MIDI stream bytes.
C4 is middle C.  A new octave begins with C, so the B below middle C is B3 or b3.
Note that all channel numbers and program numbers are 1-based in the @command{textmidi} file.
They are adjusted to be 0-based in the binary file.  This reflects
practice as it appears in the MIDI specification.
An example of the format follows:

@smallexample
FILEHEADER 3 240
STARTTRACK
END_OF_TRACK
@lbracechar{}
  NOTE_ON 1 C4 64
  DELAY 960
  NOTE_ON 1 C4 0
  NOTE_ON 1 C4 64
  DELAY 960
  NOTE_OFF 1 C4 0
  LAZY
  C4 1
  END_LAZY
@rbracechar{}
STARTTRACK

END_OF_TRACK
@end smallexample

@
@menu
* FILEHEADER::
* Tracks::
@end menu

@node FILEHEADER
@section FILEHEADER
@cindex  FILEHEADER
@b{FILEHEADER} takes three arguments:
@itemize
@item An integer number of tracks
@item Ticks per quarter (ignored)
@item An optional file format: MONOTRACK | MULTITRACK | MULTISEQUENCE.
The default is MULTITRACK.
@end itemize

@node Tracks
@section Tracks
@cindex Tracks
A track contains the musical data in a MIDI sequence.
In @command{textmidi} language, a track is defined with either STARTRACK and END_OF_TRACK or by braces:

@smallexample
FILEHEADER 1 384
STARTTRACK
TEMPO 120
TIME_SIGNATURE 4 4 24
PROGRAM 1 1
NOTE_ON C4 63
DELAY 960
NOTE_OFF C4 63
END_OF_TRACK
@end smallexample

or

@smallexample
FILEHEADER 1 384
@lbracechar{}
    TEMPO 120
    TIME_SIGNATURE 4 4 24
    PROGRAM 1 1
    NOTE_ON C4 63
    DELAY 960
    NOTE_OFF C4 63
@rbracechar{}
@end smallexample

Track data can be expressed explicitly in DETAIL mode, the default mode,
or in LAZY mode, which makes it possible to type in musical more quickly.

@menu
* DETAIL track mode::
* LAZY track mode::
@end menu

@node DETAIL track mode
@subsection DETAIL track mode
@cindex  DETAIL track mode

@menu
* Note Events::
* DELAY::
* Text meta events::
* Non-text meta events::
* Unknown meta events::
* MIDI Events::
* SEQUENCER_SPECIFIC::
* SYSEX::
@end menu

@node Note Events
@subsubsection Note Events
@cindex Note Events
@table @asis
@item NOTE_ON channelnum pitchname velocity
@cindex NOTE_ON
NOTE_ON events put a note-on event into the MIDI file.
@example
NOTE_ON 1 G4 57
@end example
The pitch may be given with a letter a@minus{}g,
@cindex pitch names
@itemize
@item sharps: @quotedblleft{}#@quotedblright{}
@item flats: @quotedblleft{}b@quotedblright{} (must be lower-case b)
@item double-sharps: @quotedblleft{}x@quotedblright{}
@item double flats: @quotedblleft{}bb@quotedblright{}
@end itemize
an octave @minus{}1 to 9 (MIDI pitches range from C@minus{}1 to G9).
@item NOTE_OFF channelnum pitchname velocity
@cindex NOTE_OFF
@example
NOTE_OFF 1 G4 57
@end example
@end table

@node DELAY
@subsubsection DELAY
@cindex DELAY num
@smallexample
DELAY ticksnum
@end smallexample
@example
DELAY 960
@end example
Note that textmidi is not line-oriented except for some uses of the text events.
You may write
@example
DELAY 72 NOTE_ON 1 B4 53
@end example
and follow it with as many more events as you like.

A delay in MIDI ticks inserts that delay into the MIDI file.
DELAY times are not events; the accumulated delay is not written into the
MIDI stream until the next event.  If no DELAY events are inserted
in DETAIL mode, then the mandatory delays inserted into the MIDI file will all be
zero.  That is allowed, but the music will be unexpectedly quick.
LAZY mode calculates and inserts the delay values before each event for you.
DELAYS may be zero to 268435455 in MIDI tick units.

@node Text meta events
@subsubsection Text meta events
@cindex Text meta events
Text meta events (a sort of MIDI pseudo-event that appears only in MIDI files)
take string arguments.  These events may repeat throughout the track
within Detail mode.  The string data the follows text event commands must either use the remainder of a line, or be double-quoted.
Escaped characters in this list may be embedded in string events: \r (carriage return), 
\n (line-feed), \a (bell), \" (double-quote), \f (formfeed), \b (backspace), 
\t (tab), \v (vertical tab).

@smallexample
TEXT "Rewrite this measure" TIME_SIGNATURE 3 4 24
TEXT_08 "Rewrite this measure" TIME_SIGNATURE 3 4 24
TEXT_09 "Rewrite this measure" TIME_SIGNATURE 3 4 24
TEXT_0A "Rewrite this measure" TIME_SIGNATURE 3 4 24
TEXT_0B "Rewrite this measure" TIME_SIGNATURE 3 4 24
TEXT_0C "Rewrite this measure" TIME_SIGNATURE 3 4 24
TEXT_0D "Rewrite this measure" TIME_SIGNATURE 3 4 24
TEXT_0E "Rewrite this measure" TIME_SIGNATURE 3 4 24
TEXT_0F "Rewrite this measure" TIME_SIGNATURE 3 4 24
@end smallexample

or

@smallexample
TEXT Rewrite this measure
TIME_SIGNATURE 3 4 24
@end smallexample

@table @option
@cindex @command{textmidi} text meta events
Note that <EOL> refers to end-of-line, that is, no commands follow on the same line.
Text events can be written with no quotes if no commands follow.
If the text is put inside quotes, then other commands may follow on the same line.
@item TEXT [string]<EOL> or TEXT "a string" [more commands]
@cindex TEXT
@example
TEXT "See above"
@end example
@item COPYRIGHT  [string]<EOL> or COPYRIGHT "string" [more commands]
@cindex COPYRIGHT
The copyright notice meta event.
@example
COPYRIGHT Copyright @copyright{} 1823 Ludwig van Beethoven
@end example
@item TRACK [string]<EOL> or TRACK "string"
@cindex TRACK
The track name.
@example
TRACK "Trumpet stings"
@end example
@item INSTRUMENT [string]<EOL> or INSTRUMENT "string" [more commands]
@cindex INSTRUMENT
The instrument name for the given track.
This is only a string and
does not effect the General MIDI instrument preset.
@example
INSTRUMENT "Flugel Horn or best substitute"
@end example
@item LYRIC [string]<EOL> or LYRIC "string"
@cindex LYRIC
A lyric string.
@example
LYRIC "No lyric could be cleared, oh Baby!"
@end example
@item MARKER [string]<EOL> or MARKER "string"
@cindex MARKER
@example
MARKER "Letter A"
@end example
@item CUE_POINT [string]<EOL> or CUE_POINT "string"
@cindex CUE_POINT
@example
CUE_POINT "Letter A"
@end example
It is not entirely clear what the MIDI spec meant, or how studio musicians
use these.
@end table

@node Non-text meta events
@subsubsection Non-text meta events
@cindex Non-text meta events
Non-text meta events.
@table @option
@item TEMPO num
@cindex TEMPO
TEMPO is set in beats per minute for a quarter note.  The tempo is per
quarter note even if the time signature has designated the beat as an
eighth note.  This restriction to quarter notes comes from the MIDI spec.
You can still use any time signature, but you need to compute the
tempo for a quarter note in that time signature.
@example
TEMPO 72
@end example
@item KEY_SIGNATURE note_name
@cindex KEY_SIGNATURE
KEY_SIGNATURE is given as a note name like the pitch names, but with no octave.
Lower-case keys are minor keys and upper-case keys are major keys.
The flat sign (a b) must always be lower-case.

C-flat major:
@smallexample
Cb
@end smallexample

C-sharp major:
@smallexample
C#
@end smallexample

C-sharp minor:
@smallexample
c#
@end smallexample

F-minor
@smallexample
f
@end smallexample

@item TIME_SIGNATURE @lbracechar{}beats_per_measure@rbracechar{} @lbracechar{}beatduration@rbracechar{} @lbracechar{}ticksperbeat@rbracechar{}
@cindex TIME_SIGNATURE
The value beats_per_measure is the traditional musical value and must be an integer.
It can be 1, 2, and up.
The value for beatduration is the traditional musical part of a time-signature giving the value-per-beat,
such as 4 for a quarter note, or 1 for a whole note.
Note that beatduration must be a positive integer.
The value for ticksperbeat is MIDI ticks in a beat.  It is often 240, but 384 is common as well.
@example
TIME_SIGNATURE 3 4 240
@end example
@item SMPTE_OFFSET @lbracechar{}smpte_24fps|smpte_25fps|smpte_30fpsdropframe|smpte_30fpsnondropframe@rbracechar{} HH:MM:SS:Frame:framefraction
@cindex SMPTE_OFFSET  
@example
SMPTE_OFFSET 07:47:13:07:11
@end example
@item SEQUENCE_NUMBER num
@example
SEQUENCE_NUMBER 1
@cindex SEQUENCE_NUMBER 
@end example
@item MIDI_CHANNEL num
@cindex MIDI_CHANNEL 
@example
MIDI_CHANNEL 1
@cindex MIDI_CHANNEL 
@end example
@item END_OF_TRACK or @rbracechar{}.
@cindex END_OF_TRACK  
MIDI tracks must end with either an END_OF_TRACK or @rbracechar{}.
@item SEQUENCER_SPECIFIC byte byte byte...
@cindex SEQUENCER_SPECIFIC 
@end table

@node Unknown meta events
@subsubsection Unknown meta events
@cindex Unknown meta events
Unknown meta events (that is, META events using unassigned meta codes)
take byte arguments in the format of SYSEX.  These are META events that the MIDI spec has not assigned.
These events may repeat throughout the track
while within DETAIL mode.  Do not include the length: @command{textmidi} will compute the length and put it in the MIDI file as
a variable-length integer.
The individual values may be hexadecimal, prefixed with "0x", or decimal, but must not exceed 255 decimal.
@smallexample
UNKNOWN_META meta_code_byte data_byte...
@end smallexample
or
@smallexample
UNKNOWN_META 0x11 0xFF
@end smallexample

@node MIDI Events
@subsubsection MIDI Events
@cindex MIDI Events

MIDI events
@table @option
@cindex events
@item NOTE_ON channel_num pitch velocity_number
@cindex NOTE_ON
@example
NOTE_ON 1 G4 57
@end example
@item NOTE_OFF channel_num pitch velocity_number
@cindex NOTE_OFF
@example
NOTE_OFF 1 G4 57
@end example
@item POLY_KEY_PRESSURE channel_num pitch velocity_number
@cindex POLY_KEY_PRESSURE
@example
POLY_KEY_PRESSURE 1 G4 100
@end example
A succession of POLY_KEY_PRESSURE commands, with delays between them, can
create swelling and fading effects if the player used supports poly key
pressure.
@item CONTROL channel_num control_num value_num
@cindex CONTROL
@example
CONTROL 13 64 10
@end example
Some MIDI controls have synonyms:
@item RESETALL channel_num
@cindex RESETALL
This would probably not be used in a MIDI file, but only by a MIDI player.
Nevertheless it is available in @command{textmidi}.
@item ALLNOTES_OFF channel_num
@cindex ALLNOTES_OFF
This would probably not be used in a MIDI file, but only by a MIDI player.
Nevertheless it is available in @command{textmidi}.
@item ALL_SOUND_OFF channel_num
@cindex ALL_SOUND_OFF
This would probably not be used in a MIDI file, but only by a MIDI player.
Nevertheless it is available in @command{textmidi}.
@item DAMPER channelnum value
@cindex DAMPER
The damper pedal on a piano.
@example
DAMPER 6 64
@end example
@item SOFTPEDAL channelnum value
@cindex SOFTPEDAL
The soft pedal on a piano.
@example
SOFTPEDAL 7 121
@end example
@item PORTAMENTO channel_num ON|OFF
@cindex PORTAMENTO
@example
PORTAMENTO 8 ON
PORTAMENTO 8 OFF
@end example
@item SOSTENUTO channel_num ON|OFF
@cindex SOSTENUTO
The sostenuto pedal on a piano: only the keys being held at the time
are sustained, not notes following the pedal.
@example
SOSTENUTO 11 ON
SOSTENUTO 11 OFF
@end example
@item BREATH channel_num value_num
@cindex BREATH
@example
BREATH 12 53
@end example
@item PAN channel_num left|center|right|@lbracechar{}-64..63@rbracechar{}
@cindex PAN
When using the numeric pan values, note that -64 is left-most, 63 is
right-most, and 0 is in the center.
@example
PAN 13 left
PAN 13 center 
PAN 13 right 
PAN 13 33
@end example
@item PROGRAM channel_num program_num
@cindex PROGRAM
PROGRAM selects a General MIDI intrument.
The program is 1-based.
@example
PROGRAM 14 47
@end example
@item CHANNEL_PRESSURE channel_num pressure_num
@cindex CHANNEL_PRESSURE 
A per-channel pressure.  Pressure is on the velocity scale from 0 to 127.
@example
CHANNEL_PRESSURE 15 120
@end example
@item PITCH_WHEEL channel_num wheel_num
@cindex PITCH_WHEEL 
@example
PITCH_WHEEL 16 16000
@end example
Bend values are in 14 bits, 0 to 16383.
@item MIDI_PORT num
@cindex MIDI_PORT
@end table

@node SEQUENCER_SPECIFIC
@subsubsection SEQUENCER_SPECIFIC
@cindex SEQUENCER_SPECIFIC
SEQUENCER_SPECIFIC is a way of inserting proprietary synthesizer commands
into a standard MIDI file.  It is the command SEQUENCER_SPECIFIC followed by
1-byte values.  Do not include the length of the data; textmidi will compute
the length and insert it before the data bytes.
The values may be either 2-digit hexadecimal byte values prefaced with 
@quotedblleft{}0x@quotedblright{}, or decimal numbers from 0 to 255.
@smallexample
SEQUENCER_SPECIFIC 0x43 0x73 0x7f 0x32 0x11 0x00 0x1B 0x03
@end smallexample

@node SYSEX
@subsubsection SYSEX
@cindex SYSEX
SYSEX, or System Exclusive, is a way of inserting proprietary synthesizer commands
into a standard MIDI file. There are two types of SYSEX commands:
@table @asis
@item SYSEX byte byte byte...
Note that the bytes can in decimal or hexadecimal.  Hexadecimal bytes must start with "0x".
Do not include the SYSEX command, F0, the length, or the final F7.  The @command{textmidi} program will add those.
Note that the values of the bytes should fit in a byte, and have values from 0 to 255 decimal, or 0x00 to 0xFF
hexadecimal.
One particular synthesizer permits setting the metronome using a SYSEX command:

@smallexample
SYSEX 0x43 0x73 0x7f 0x32 0x11 0x00 0x1B 0x03
@end smallexample

The @command{textmidi} program will add F0 and a length of 9 to the front of
the message, and an F7 to the end.  (The length includes only the
functional data and the terminating F7).
@item SYSEXRAW byte byte byte...
SYSEXRAW also takes either decimal or hexadecimal byte values.  It permits
sending a more freely-formatted block of data, and is fully specified
by the synthesizer or effects box vendor.  Do not include the F7 at the
start, or a length unless the synthesizer manufacturer specifies it,
or an F7 at the end unless the synthesizer manufacturer requires it.
Some manufacturers use SYSEXRAW to continue long messages that start
with a SYSEX block.
@end table


@node LAZY track mode
@subsection LAZY track mode
@cindex LAZY track mode
At any time in a track, during DETAIL mode,
a LAZY (or BRIEF) command can be inserted in order to enter LAZY mode.
You can leave LAZY mode and return to DETAIL mode at any time.
There may be as many LAZY or DETAIL mode sections as needed.
For example, in some music, it is necessary to reset the time signature
in mid-track, especially the rhythm track (often the first track in a multitrack file).
Since the TIME_SIGNATURE command is only available in DETAIL MODE, then if the track
is in LAZY mode, a short section of DETAIL mode can make it possible to set the time
signature and return to lazy mode:

@smallexample
LAZY
C4 E4 G4 4
END_LAZY
TIME_SIGNATURE 3 4 24
LAZY
D4 F4 A4 4
...
@end smallexample

There are some directives available in @command{textmidi} DETAIL mode.

@table @option
@item ticks
@cindex ticks
When this directive is encountered, print the accumulated MIDI tick value
to the screen.  This is a @command{textmidi} file debugging feature.
If the tracks get misaligned by a small number of ticks, then the ticks 
directive can help find where they go out of sync.
@item Symbolic dynamic
@cindex dynamics
Set the dynamic with symbols @lbracechar{}pppp|ppp|pp|p|mp|mf|forte|ff|fff|ffff@rbracechar{}.
The dynamic must appear between events and delays.
@item vel num
@cindex vel
Set the velocity (dynamic) for following note events.  Num is in (0..127).
Relative dynamics permit changing the dynamic without referring to the current
value. This is helpful for accents.

@smallexample
ff C4 4 vel -10 D4 4 vel +10 E 4
@end smallexample
@item chan channel_num
Set the MIDI channel.
@item END_LAZY, END_BRIEF, DETAIL
@end table

@menu
* Notes::
* Chords::
* Rhythm::
* Ties::
* Rests::
@end menu

@node Notes
@subsubsection Notes
@cindex Note events
LAZY mode note events.
In LAZY mode you simply type in the notes followed by musical durations.
To march a C-major scale in quarter notes you would simply write

@smallexample
C4 4 D4 4 E4 4 F4 4 G4 4 A4 4 B4 4 C5 4
@end smallexample

Lower case notes are allowed:

@smallexample
c4 4. d4 8 e4 4. f4 8 g4 4. a4 8 b4 4. c5 8
@end smallexample

To use accidentals, add a lower-case b for a flat, or a # for a sharp.

@smallexample
c#4 e4 4. d4 f4 8 e4 g4 4. f4 ab4 8 g4 b4 4. a4 c5 8 b4 d5 4. c5 eb5 8
@end smallexample

@node Chords
@subsubsection Chords
@cindex Chords
To make chords, merely add the chord notes before specifying the duration:

@smallexample
c4 e4 4. d4 f4 8 e4 g4 4. f4 a4 8 g4 b4 4. a4 c5 8 b4 d5 4. c5 e5 8
@end smallexample

@node Rhythm
@subsubsection Rhythm
@cindex Rhythm
Rhythm in LAZY mode is given in duration ratios, that is, fractions of 
whole notes, just as in
traditional music notation.  In addition, if the numerator is 1, then the
denominator alone may be given instead.
@itemize
@item 1/4 @minus{} quarter note
@item 4 @minus{} quarter note
@item 1/4. @minus{} dotted quarter note
@item 4. @minus{} dotted quarter note
@item 3 @minus{} a third note (i.e., a triplet half note, three to a whole note)
@item 5/16 @minus{} a note five sixteenths long
@item 1 @minus{} a whole note
@item 4/1 @minus{} 4 whole notes.
@end itemize
Note that to get 4 whole notes you must write 4/1 (or 8/2), but not a 4 by itself.

To use dotted quarters, add a period to the duration
(double dots are also supported):

@smallexample
C4 4. D4 8 E4 4. F4 8 G4 4. A4 8 B4 4. C5 8
C4 4.. D4 16 E4 4.. F4 16 G4 4.. A4 16 B4 4.. C5 16
@end smallexample

Durations are fractions of a whole notes,
but if the numerator is 1, as for 1/4 (a quarter note) then just write
the denominator (4).  Any positive integers are allowed.
Using unusual values, for example for trills, might cause the accumulated
MIDI tick value to not line-up with what you consider to be the measure bar.
That is why the tick directive was added to aid in tick value debugging.

@smallexample
C4 111/445 D4 1/4 E4 1/4 F4 1/4 R 4 A4 3/4 B4 2/3 C5 23/17
@end smallexample

@node Ties
@subsubsection Ties
@cindex Ties
To tie a note, add dashes.
A dash to the right of the note name means it ties out.  A dash on the
left means the note is tied in.  If there is no tie on the right of a note,
the note ends following the following duration.
If you forget the tied-in note, the note will be stuck when you play the MIDI file.

@smallexample
c#4 e4- 4. d4 f4 8 e4 g4 4. f4 ab4 8 g4 b4 4. a4 c5 8 -e4 b4 d5 4. c5 eb5 8
@end smallexample

@node Rests
@subsubsection Rests
@cindex Rests
An R inserts a rest.

@smallexample
C4 4 R 4 E4 4
@end smallexample

Any LAZY mode directives must be after a duration and before a notename.
The chan directive and the vel directive (and other dynamics) apply to all following
notes until another directive changes them.

@smallexample
c#4 e4- 4. chan 3 d4 f4 8 e4 g4 4. ff f4 ab4 8 g4 b4 4. vel -5 a4 c5 8 -e4 b4 d5 4. c5 eb5 8
@end smallexample

@node Using m4 with textmidi
@chapter Using m4 with textmidi
@cindex m4
It can be convenient to use the m4 macro processor.  A trill that is defined
as an m4 macro need not be painstakingly written by hand.
Note that as the @command{textmidi} comment character is a semicolon ";",
you should change the m4 comment character to semicolon using
the m4 directive changecom.
A trill in m4 could be defined:
@example
define(`trill_68_mid',`$1 1/16 $2 1/16 $1 1/16 $2 1/16 $1 1/16 $2 1/16 ')
@end example
Then to use this trill in a file called prelude.m4 you type
@example
trill_68_mid(C4,D4)
@end example
Then prelude.m4 is processed by m4 into a textmidi file, which can be 
converted into a MIDI file:
@example
m4 prelude.m4 > prelude.txt
textmidi -midi prelude.mid prelude.txt
@end example
Another example of using m4 is to define in an m4 file all of the General MIDI
instruments to the numbers they are assigned, including that into a textmidi/m4
file, and then running that through m4 to create the textmidi file with the instruments
replaced by program numbers.
@node File Formats
@chapter File Formats
The input text file for @command{textmidi} is a free-form text file, with exceptions.
The @command{textmidi} directives for text to be inserted into the MIDI file
must either run to the end of the line or have data strings that are double-quoted.

@node Gvim Highlighting
@chapter gvim highlighting for textmidi language
A vim highlighting file is provided for the textmidi language.
The file is called textmidi.vim.  To install it, copy it to ~/.vim/syntax/textmidi.vim.
Edit the file ~/.vim/syntax/fileytpe.vim to add recognition of FILEHEADER:
@example
if did_filetype()
  finish
endif
if getline(1) =~ 'FILEHEADER [[:digit:]]+ [[:digit:]]+$'
  setf textmidi
endif
@end example

In ~/.vim/scripts.vim add support for textmidi:

@example
if did_filetype()
  finish
endif
if getline(1) =~ '^FILEHEADER.*'
  setfiletype textmidi
endif
@end example

@node Installation
@chapter Installation
This program was prepared for builds using GNU autoconf tools.
Unpack the archive.  Move to the directory created for the program.
Run the configure script and run make.
@example
./configure
make
@end example
Make yourself superuser (root), or use sudo to run install targets:
@example
make install
make install-info
@end example

@node GNU Free Documentation License
@chapter GNU Free Documentation License
Version 1.3, 3 November 2008
Copyright @copyright{} 2000, 2001, 2002, 2007, 2008 Free Software Foundation, Inc.
https://fsf.org/
Everyone is permitted to copy and distribute verbatim copies
of this license document, but changing it is not allowed.
@section PREAMBLE
The purpose of this License is to make a manual, textbook, or other functional and
useful document free in the sense of freedom: to assure everyone the effective freedom
to copy and redistribute it, with or without modifying it, either commercially or non-
commercially. Secondarily, this License preserves for the author and publisher a way
to get credit for their work, while not being considered responsible for modifications
made by others.
This License is a kind of “copyleft”, which means that derivative works of the document
must themselves be free in the same sense. It complements the GNU General Public
License, which is a copyleft license designed for free software.
We have designed this License in order to use it for manuals for free software, because
free software needs free documentation: a free program should come with manuals
providing the same freedoms that the software does. But this License is not limited to
software manuals; it can be used for any textual work, regardless of subject matter or
whether it is published as a printed book. We recommend this License principally for
works whose purpose is instruction or reference.
@section APPLICABILITY AND DEFINITIONS
This License applies to any manual or other work, in any medium, that contains a
notice placed by the copyright holder saying it can be distributed under the terms
of this License. Such a notice grants a world-wide, royalty-free license, unlimited in
duration, to use that work under the conditions stated herein.
The “Document”,
below, refers to any such manual or work. Any member of the public is a licensee, and
is addressed as “you”. You accept the license if you copy, modify or distribute the work
in a way requiring permission under copyright law.
A “Modified Version” of the Document means any work containing the Document or
a portion of it, either copied verbatim, or with modifications and/or translated into
another language.
A “Secondary Section” is a named appendix or a front-matter section of the Document
that deals exclusively with the relationship of the publishers or authors of the Document
to the Document’s overall subject (or to related matters) and contains nothing that
could fall directly within that overall subject. (Thus, if the Document is in part a
textbook of mathematics, a Secondary Section may not explain any mathematics.) The
relationship could be a matter of historical connection with the subject or with related
matters, or of legal, commercial, philosophical, ethical or political position regarding
them.
The “Invariant Sections” are certain Secondary Sections whose titles are designated, as
being those of Invariant Sections, in the notice that says that the Document is released
under this License. If a section does not fit the above definition of Secondary then it is
not allowed to be designated as Invariant. The Document may contain zero Invariant
Sections. If the Document does not identify any Invariant Sections then there are none.
The “Cover Texts” are certain short passages of text that are listed, as Front-Cover
Texts or Back-Cover Texts, in the notice that says that the Document is released under
this License. A Front-Cover Text may be at most 5 words, and a Back-Cover Text may
be at most 25 words.
A “Transparent” copy of the Document means a machine-readable copy, represented
in a format whose specification is available to the general public, that is suitable for
revising the document straightforwardly with generic text editors or (for images com-
posed of pixels) generic paint programs or (for drawings) some widely available drawing
editor, and that is suitable for input to text formatters or for automatic translation to
a variety of formats suitable for input to text formatters. A copy made in an otherwise
Transparent file format whose markup, or absence of markup, has been arranged to
thwart or discourage subsequent modification by readers is not Transparent. An image
format is not Transparent if used for any substantial amount of text. A copy that is
not “Transparent” is called “Opaque”.
Examples of suitable formats for Transparent copies include plain ASCII without
markup, Texinfo input format, LaTEX input format, SGML or XML using a publicly
available DTD, and standard-conforming simple HTML, PostScript or PDF designed
for human modification. Examples of transparent image formats include PNG, XCF
and JPG. Opaque formats include proprietary formats that can be read and edited
only by proprietary word processors, SGML or XML for which the DTD and/or pro-
cessing tools are not generally available, and the machine-generated HTML, PostScript
or PDF produced by some word processors for output purposes only.
The “Title Page” means, for a printed book, the title page itself, plus such following
pages as are needed to hold, legibly, the material this License requires to appear in the
title page. For works in formats which do not have any title page as such, “Title Page”
means the text near the most prominent appearance of the work’s title, preceding the
beginning of the body of the text.
The “publisher” means any person or entity that distributes copies of the Document
to the public.
A section “Entitled XYZ” means a named subunit of the Document whose title either
is precisely XYZ or contains XYZ in parentheses following text that translates XYZ in
another language. (Here XYZ stands for a specific section name mentioned below, such
as “Acknowledgements”, “Dedications”, “Endorsements”, or “History”.) To “Preserve
the Title” of such a section when you modify the Document means that it remains a
section “Entitled XYZ” according to this definition.
The Document may include Warranty Disclaimers next to the notice which states that
this License applies to the Document. These Warranty Disclaimers are considered to
be included by reference in this License, but only as regards disclaiming warranties:
any other implication that these Warranty Disclaimers may have is void and has no
effect on the meaning of this License.
@section VERBATIM COPYING
You may copy and distribute the Document in any medium, either commercially or
noncommercially, provided that this License, the copyright notices, and the license
notice saying this License applies to the Document are reproduced in all copies, and
that you add no other conditions whatsoever to those of this License. You may not use
technical measures to obstruct or control the reading or further copying of the copies
you make or distribute. However, you may accept compensation in exchange for copies.
If you distribute a large enough number of copies you must also follow the conditions
in section 3.
You may also lend copies, under the same conditions stated above, and you may publicly
display copies.
@section COPYING IN QUANTITY
If you publish printed copies (or copies in media that commonly have printed covers) of
the Document, numbering more than 100, and the Document’s license notice requires
Cover Texts, you must enclose the copies in covers that carry, clearly and legibly, all
these Cover Texts: Front-Cover Texts on the front cover, and Back-Cover Texts on
the back cover. Both covers must also clearly and legibly identify you as the publisher
of these copies. The front cover must present the full title with all words of the title
equally prominent and visible. You may add other material on the covers in addition.
Copying with changes limited to the covers, as long as they preserve the title of the
Document and satisfy these conditions, can be treated as verbatim copying in other
respects.
If the required texts for either cover are too voluminous to fit legibly, you should put
the first ones listed (as many as fit reasonably) on the actual cover, and continue the
rest onto adjacent pages.
If you publish or distribute Opaque copies of the Document numbering more than 100,
you must either include a machine-readable Transparent copy along with each Opaque
copy, or state in or with each Opaque copy a computer-network location from which
the general network-using public has access to download using public-standard network
protocols a complete Transparent copy of the Document, free of added material. If
you use the latter option, you must take reasonably prudent steps, when you begin
distribution of Opaque copies in quantity, to ensure that this Transparent copy will
remain thus accessible at the stated location until at least one year after the last time
you distribute an Opaque copy (directly or through your agents or retailers) of that
edition to the public.
It is requested, but not required, that you contact the authors of the Document well
before redistributing any large number of copies, to give them a chance to provide you
with an updated version of the Document.
@section MODIFICATIONS
You may copy and distribute a Modified Version of the Document under the conditions
of sections 2 and 3 above, provided that you release the Modified Version under precisely
this License, with the Modified Version filling the role of the Document, thus licensing
distribution and modification of the Modified Version to whoever possesses a copy of
it. In addition, you must do these things in the Modified Version:
A. Use in the Title Page (and on the covers, if any) a title distinct from that of the
Document, and from those of previous versions (which should, if there were any,
be listed in the History section of the Document). You may use the same title as
a previous version if the original publisher of that version gives permission.
B. List on the Title Page, as authors, one or more persons or entities responsible for
authorship of the modifications in the Modified Version, together with at least five
of the principal authors of the Document (all of its principal authors, if it has fewer
than five), unless they release you from this requirement.
C. State on the Title page the name of the publisher of the Modified Version, as the
publisher.
D. Preserve all the copyright notices of the Document.
E. Add an appropriate copyright notice for your modifications adjacent to the other
copyright notices.
F. Include, immediately after the copyright notices, a license notice giving the public
permission to use the Modified Version under the terms of this License, in the form
shown in the Addendum below.
G. Preserve in that license notice the full lists of Invariant Sections and required Cover
Texts given in the Document’s license notice.
H. Include an unaltered copy of this License.
I. Preserve the section Entitled “History”, Preserve its Title, and add to it an item
stating at least the title, year, new authors, and publisher of the Modified Version
as given on the Title Page. If there is no section Entitled “History” in the Docu-
ment, create one stating the title, year, authors, and publisher of the Document
as given on its Title Page, then add an item describing the Modified Version as
stated in the previous sentence.
J. Preserve the network location, if any, given in the Document for public access to
a Transparent copy of the Document, and likewise the network locations given in
the Document for previous versions it was based on. These may be placed in the
“History” section. You may omit a network location for a work that was published
at least four years before the Document itself, or if the original publisher of the
version it refers to gives permission.
K. For any section Entitled “Acknowledgements” or “Dedications”, Preserve the Title
of the section, and preserve in the section all the substance and tone of each of the
contributor acknowledgements and/or dedications given therein.
L. Preserve all the Invariant Sections of the Document, unaltered in their text and
in their titles. Section numbers or the equivalent are not considered part of the
section titles.
M. Delete any section Entitled “Endorsements”. Such a section may not be included
in the Modified Version.
N. Do not retitle any existing section to be Entitled “Endorsements” or to conflict in
title with any Invariant Section.
O. Preserve any Warranty Disclaimers.
If the Modified Version includes new front-matter sections or appendices that qualify
as Secondary Sections and contain no material copied from the Document, you may at
your option designate some or all of these sections as invariant. To do this, add their
titles to the list of Invariant Sections in the Modified Version’s license notice. These
titles must be distinct from any other section titles.
You may add a section Entitled “Endorsements”, provided it contains nothing but
endorsements of your Modified Version by various parties—for example, statements of
peer review or that the text has been approved by an organization as the authoritative
definition of a standard.
You may add a passage of up to five words as a Front-Cover Text, and a passage of up
to 25 words as a Back-Cover Text, to the end of the list of Cover Texts in the Modified
Version. Only one passage of Front-Cover Text and one of Back-Cover Text may be
added by (or through arrangements made by) any one entity. If the Document already
includes a cover text for the same cover, previously added by you or by arrangement
made by the same entity you are acting on behalf of, you may not add another; but
you may replace the old one, on explicit permission from the previous publisher that
added the old one.
The author(s) and publisher(s) of the Document do not by this License give permission
to use their names for publicity for or to assert or imply endorsement of any Modified
Version.
@section COMBINING DOCUMENTS
You may combine the Document with other documents released under this License,
under the terms defined in section 4 above for modified versions, provided that you
include in the combination all of the Invariant Sections of all of the original documents,
unmodified, and list them all as Invariant Sections of your combined work in its license
notice, and that you preserve all their Warranty Disclaimers.
The combined work need only contain one copy of this License, and multiple identical
Invariant Sections may be replaced with a single copy. If there are multiple Invariant
Sections with the same name but different contents, make the title of each such section
unique by adding at the end of it, in parentheses, the name of the original author or
publisher of that section if known, or else a unique number. Make the same adjustment
to the section titles in the list of Invariant Sections in the license notice of the combined
work.
In the combination, you must combine any sections Entitled “History” in the vari-
ous original documents, forming one section Entitled “History”; likewise combine any
sections Entitled “Acknowledgements”, and any sections Entitled “Dedications”. You
must delete all sections Entitled “Endorsements.”
@section COLLECTIONS OF DOCUMENTS
You may make a collection consisting of the Document and other documents released
under this License, and replace the individual copies of this License in the various
documents with a single copy that is included in the collection, provided that you
follow the rules of this License for verbatim copying of each of the documents in all
other respects.
You may extract a single document from such a collection, and distribute it individu-
ally under this License, provided you insert a copy of this License into the extracted
document, and follow this License in all other respects regarding verbatim copying of
that document.
@section AGGREGATION WITH INDEPENDENT WORKS
A compilation of the Document or its derivatives with other separate and independent
documents or works, in or on a volume of a storage or distribution medium, is called
an “aggregate” if the copyright resulting from the compilation is not used to limit the
legal rights of the compilation’s users beyond what the individual works permit. When
the Document is included in an aggregate, this License does not apply to the other
works in the aggregate which are not themselves derivative works of the Document.
If the Cover Text requirement of section 3 is applicable to these copies of the Document,
then if the Document is less than one half of the entire aggregate, the Document’s Cover
Texts may be placed on covers that bracket the Document within the aggregate, or the
electronic equivalent of covers if the Document is in electronic form. Otherwise they
must appear on printed covers that bracket the whole aggregate.
@section TRANSLATION
Translation is considered a kind of modification, so you may distribute translations
of the Document under the terms of section 4.
Replacing Invariant Sections with
translations requires special permission from their copyright holders, but you may
include translations of some or all Invariant Sections in addition to the original versions
of these Invariant Sections. You may include a translation of this License, and all the
license notices in the Document, and any Warranty Disclaimers, provided that you
also include the original English version of this License and the original versions of
those notices and disclaimers. In case of a disagreement between the translation and
the original version of this License or a notice or disclaimer, the original version will
prevail.
If a section in the Document is Entitled “Acknowledgements”, “Dedications”, or “His-
tory”, the requirement (section 4) to Preserve its Title (section 1) will typically require
changing the actual title.
@section TERMINATION
You may not copy, modify, sublicense, or distribute the Document except as expressly
provided under this License. Any attempt otherwise to copy, modify, sublicense, or
distribute it is void, and will automatically terminate your rights under this License.
However, if you cease all violation of this License, then your license from a particular
copyright holder is reinstated (a) provisionally, unless and until the copyright holder
explicitly and finally terminates your license, and (b) permanently, if the copyright
holder fails to notify you of the violation by some reasonable means prior to 60 days
after the cessation.
Moreover, your license from a particular copyright holder is reinstated permanently if
the copyright holder notifies you of the violation by some reasonable means, this is the
first time you have received notice of violation of this License (for any work) from that
copyright holder, and you cure the violation prior to 30 days after your receipt of the
notice.
Termination of your rights under this section does not terminate the licenses of parties
who have received copies or rights from you under this License. If your rights have
been terminated and not permanently reinstated, receipt of a copy of some or all of the
same material does not give you any rights to use it.
@section FUTURE REVISIONS OF THIS LICENSE
The Free Software Foundation may publish new, revised versions of the GNU Free
Documentation License from time to time. Such new versions will be similar in spirit
to the present version, but may differ in detail to address new problems or concerns.
See https://www.gnu.org/copyleft/.
Each version of the License is given a distinguishing version number. If the Document
specifies that a particular numbered version of this License “or any later version”
applies to it, you have the option of following the terms and conditions either of that
specified version or of any later version that has been published (not as a draft) by
the Free Software Foundation. If the Document does not specify a version number of
this License, you may choose any version ever published (not as a draft) by the Free
Software Foundation. If the Document specifies that a proxy can decide which future
versions of this License can be used, that proxy’s public statement of acceptance of a
version permanently authorizes you to choose that version for the Document.
@section RELICENSING
“Massive Multiauthor Collaboration Site” (or “MMC Site”) means any World Wide
Web server that publishes copyrightable works and also provides prominent facilities
for anybody to edit those works. A public wiki that anybody can edit is an example of
such a server. A “Massive Multiauthor Collaboration” (or “MMC”) contained in the
site means any set of copyrightable works thus published on the MMC site.
“CC-BY-SA” means the Creative Commons Attribution-Share Alike 3.0 license pub-
lished by Creative Commons Corporation, a not-for-profit corporation with a principal
place of business in San Francisco, California, as well as future copyleft versions of that
license published by that same organization.
“Incorporate” means to publish or republish a Document, in whole or in part, as part
of another Document.
An MMC is “eligible for relicensing” if it is licensed under this License, and if all works
that were first published under this License somewhere other than this MMC, and
subsequently incorporated in whole or in part into the MMC, (1) had no cover texts
or invariant sections, and (2) were thus incorporated prior to November 1, 2008.
The operator of an MMC Site may republish an MMC contained in the site under
CC-BY-SA on the same site at any time before August 1, 2009, provided the MMC is
eligible for relicensing.
@section How to use this License for your documents
To use this License in a document you have written, include a copy of the License in the
document and put the following copyright and license notices just after the title page:
Copyright (C)
year
your name.
Permission is granted to copy, distribute and/or modify this document
under the terms of the GNU Free Documentation License, Version 1.3
or any later version published by the Free Software Foundation;
with no Invariant Sections, no Front-Cover Texts, and no Back-Cover
Texts.
A copy of the license is included in the section entitled ``GNU
Free Documentation License''.
If you have Invariant Sections, Front-Cover Texts and Back-Cover Texts, replace the
“with. . . Texts.” line with this:
with the Invariant Sections being list their titles, with
the Front-Cover Texts being list, and with the Back-Cover Texts
being list.
If you have Invariant Sections without Cover Texts, or some other combination of the
three, merge those two alternatives to suit the situation.
If your document contains nontrivial examples of program code, we recommend releasing
these examples in parallel under your choice of free software license, such as the GNU
General Public License, to permit their use in free software.

@node Bibliography
@chapter Bibliography

@itemize
@item @cite{The Complete MIDI 1.0 Detailed Specification.}
Document version 96.1.
Second edition.
1995.
Los Angeles.
The MIDI Manufacturers Association.

@end itemize

@node Concept Index
@chapter Concept Index
@printindex cp

@bye
